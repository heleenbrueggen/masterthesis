# Setting seed #
################
set.seed(123)
########
# Data #
########
load("~/Desktop/Universiteit Utrecht/Methodology & Statistics for the Behavioural, Biomedical and Social Sciences/Year 2/Master Thesis/data/simdatasets.RData")
##########
# Models #
##########
load('results/stan4bart_fits.RData')
load('results/rbart_evs.RData')
load('results/rbart_ranefs.RData')
load('results/bart_fits.RData')
load('results/gbart_fits.RData')
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(g), labeller = 'label_both', scales = 'free_x')
?facet_grid
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(g), labeller = 'label_parsed', scales = 'free_x')
?gamma
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(g), labeller = labeller(icc = label_parsed(), g = label_parsed()), scales = 'free_x')
ggplot(bias_models ,aes(
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(g), labeller = labeller(icc = label_parsed, g = label_parsed), scales = 'free_x')
ggplot(bias_models ,aes(
"\u03B3"
\u03B3
View(bias_models)
colnames(bias_models[,6])
colnames(bias_models[,6]) <- "\u03B3"
bias_models
View(bias_models)
colnames(bias_models)[6] <- "\u03B3"
colnames(mse_models)[6] <- "\u03B3"
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(g), labeller = 'label_both', scales = 'free_x')
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars("\u03B3"), labeller = 'label_both', scales = 'free_x')
# coverage
#########
# Plots #
#########
# bias for all models and all combinations
bias_models <- tibble(stan4bart = stan4bart_bias$avgbias,
rbart = rbart_bias$avgbias,
bart = bart_bias$avgbias,
gbart = gbart_bias$avgbias,
dataset = paste0((combinations[,1]*combinations[,2]), ' (', combinations[,1], ', ', combinations[,2], ')', sep = '')) %>%
cbind(., combinations) %>%
select(-mar_mcar) %>%
pivot_longer(cols = c(stan4bart, rbart, bart, gbart), names_to = 'model', values_to = 'bias') %>%
group_by(dataset, model, icc, ngroup, groupsize, g) %>%
summarise(across(bias, ~ mean(.x)), .groups = "drop") %>%
arrange((ngroup*groupsize)) %>%
mutate(dataset = factor(dataset, levels = unique(dataset)))
library(magrittr)
library(ggplot2)
library(tibble)
library(dplyr)
library(knitr)
library(gridExtra)
# coverage
#########
# Plots #
#########
# bias for all models and all combinations
bias_models <- tibble(stan4bart = stan4bart_bias$avgbias,
rbart = rbart_bias$avgbias,
bart = bart_bias$avgbias,
gbart = gbart_bias$avgbias,
dataset = paste0((combinations[,1]*combinations[,2]), ' (', combinations[,1], ', ', combinations[,2], ')', sep = '')) %>%
cbind(., combinations) %>%
select(-mar_mcar) %>%
pivot_longer(cols = c(stan4bart, rbart, bart, gbart), names_to = 'model', values_to = 'bias') %>%
group_by(dataset, model, icc, ngroup, groupsize, g) %>%
summarise(across(bias, ~ mean(.x)), .groups = "drop") %>%
arrange((ngroup*groupsize)) %>%
mutate(dataset = factor(dataset, levels = unique(dataset)))
# coverage
#########
# Plots #
#########
# bias for all models and all combinations
bias_models <- tibble(stan4bart = stan4bart_bias$avgbias,
rbart = rbart_bias$avgbias,
bart = bart_bias$avgbias,
gbart = gbart_bias$avgbias,
dataset = paste0((combinations[,1]*combinations[,2]), ' (', combinations[,1], ', ', combinations[,2], ')', sep = '')) %>%
cbind(., combinations) %>%
select(-mar_mcar) %>%
pivot_longer(cols = c(stan4bart, rbart, bart, gbart), names_to = 'model', values_to = 'bias') %>%
group_by(dataset, model, icc, ngroup, groupsize, g) %>%
summarise(across(bias, ~ mean(.x)), .groups = "drop") %>%
arrange((ngroup*groupsize)) %>%
mutate(dataset = factor(dataset, levels = unique(dataset)))
??pivot_longer
library(tidyr)
# coverage
#########
# Plots #
#########
# bias for all models and all combinations
bias_models <- tibble(stan4bart = stan4bart_bias$avgbias,
rbart = rbart_bias$avgbias,
bart = bart_bias$avgbias,
gbart = gbart_bias$avgbias,
dataset = paste0((combinations[,1]*combinations[,2]), ' (', combinations[,1], ', ', combinations[,2], ')', sep = '')) %>%
cbind(., combinations) %>%
select(-mar_mcar) %>%
pivot_longer(cols = c(stan4bart, rbart, bart, gbart), names_to = 'model', values_to = 'bias') %>%
group_by(dataset, model, icc, ngroup, groupsize, g) %>%
summarise(across(bias, ~ mean(.x)), .groups = "drop") %>%
arrange((ngroup*groupsize)) %>%
mutate(dataset = factor(dataset, levels = unique(dataset)))
# mse for all models and all combinations
mse_models <- tibble(stan4bart = stan4bart_mse$avgmse,
rbart = rbart_mse$avgmse,
bart = bart_mse$avgmse,
gbart = gbart_mse$avgmse,
dataset = paste0((combinations[,1]*combinations[,2]), ' (', combinations[,1], ', ', combinations[,2], ')', sep = '')) %>%
cbind(., combinations) %>%
select(-mar_mcar) %>%
pivot_longer(cols = c(stan4bart, rbart, bart, gbart), names_to = 'model', values_to = 'mse') %>%
group_by(dataset, model, icc, ngroup, groupsize, g) %>%
summarise(across(mse, ~ mean(.x)), .groups = "drop") %>%
arrange((ngroup*groupsize))  %>%
mutate(dataset = factor(dataset, levels = unique(dataset)))
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(g), labeller = 'label_both', scales = 'free_x')
?facet_grid
expression(gamma)
paste("\u03B3")
paste(\u03B3)
paste("\u03B3")
colnames(bias_models)[6] <- paste("\u03B3")
str(bias_models)
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(paste("\u03B3")), labeller = 'label_both', scales = 'free_x')
# coverage
#########
# Plots #
#########
# bias for all models and all combinations
bias_models <- tibble(stan4bart = stan4bart_bias$avgbias,
rbart = rbart_bias$avgbias,
bart = bart_bias$avgbias,
gbart = gbart_bias$avgbias,
dataset = paste0((combinations[,1]*combinations[,2]), ' (', combinations[,1], ', ', combinations[,2], ')', sep = '')) %>%
cbind(., combinations) %>%
select(-mar_mcar) %>%
pivot_longer(cols = c(stan4bart, rbart, bart, gbart), names_to = 'model', values_to = 'bias') %>%
group_by(dataset, model, icc, ngroup, groupsize, g) %>%
summarise(across(bias, ~ mean(.x)), .groups = "drop") %>%
arrange((ngroup*groupsize)) %>%
mutate(dataset = factor(dataset, levels = unique(dataset)))
colnames(bias_models)[6] <- paste("\u03B3")
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(g), labeller = 'label_parsed', scales = 'free_x')
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars("\u03B3"), labeller = 'label_parsed', scales = 'free_x')
bias_models$γ
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_parsed', scales = 'free_x')
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
colnames(bias_models)[6] <- paste('γ')
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
# mse for all models and all combinations
mse_models <- tibble(stan4bart = stan4bart_mse$avgmse,
rbart = rbart_mse$avgmse,
bart = bart_mse$avgmse,
gbart = gbart_mse$avgmse,
dataset = paste0((combinations[,1]*combinations[,2]), ' (', combinations[,1], ', ', combinations[,2], ')', sep = '')) %>%
cbind(., combinations) %>%
select(-mar_mcar) %>%
pivot_longer(cols = c(stan4bart, rbart, bart, gbart), names_to = 'model', values_to = 'mse') %>%
group_by(dataset, model, icc, ngroup, groupsize, g) %>%
summarise(across(mse, ~ mean(.x)), .groups = "drop") %>%
arrange((ngroup*groupsize))  %>%
mutate(dataset = factor(dataset, levels = unique(dataset)))
colnames(mse_models)[6] <- paste('γ')
ggplot(mse_models ,aes(
x = dataset,
y = mse,
fill = model,
color = model,
shape = model,
group = model
)) +
#geom_bar(stat = 'identity', position = 'identity', width = .05) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'MSE') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot4.png')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png')
?ggsave
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.pdf', dpi = 'retina')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.pdf', dpi = 'retina')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.pdf', dpi = 'retina', width = 8.8, height = 6.5, units = 'in')
warnings()
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.pdf', dpi = 'retina', width = 8.8, height = 6.92, units = 'in')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.pdf', dpi = 'retina', width = 10, height = 10, units = 'in')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.pdf', dpi = 'retina', width = 20, height = 20, units = 'in')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.pdf', dpi = 'retina')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.pdf', dpi = 'retina')
warnings()
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png', dpi = 'retina')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png', dpi = 'retina', width = 8.8, height = 6.92, units = 'in')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina', width = 8.8, height = 6.92, units = 'in')
#####################
# stan4bart package #
#####################
bla <- stan4bart(y ~ bart(x4 + x5 + x6 + x7 + z1 + z2 + x1 + x2 + x3) + (1 + x1 + x2 + x3|group),
data = simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]],
bart_args = list(verbose = FALSE,
k = 2.0,
n.samples = 1500L,
n.burn = 1500L,
n.thin = 5L))
# plotting y against predicted y from stan4bart
pred <- tibble(y = simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]$y,
ypred = fitted(stan4bart_fit, type = 'ev', sample = 'train'))
simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]
simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]$y
# plotting y against predicted y from stan4bart
pred <- tibble(y = simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]$y,
ypred = fitted(bla, type = 'ev', sample = 'train'))
ggplot(data = pred, mapping = aes(
x = y,
y = ypred
)) +
geom_point(color = 'royalblue', size = .5) +
theme_minimal() +
geom_abline(slope = 1, intercept = 0, color = 'royalblue4')
View(bla)
bla[["stan"]]
bla[["bart_train"]]
bla[["bartData"]]@x
simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]
bla[["bart_varcount"]]
bla[["bart_train"]] %>% View()
.
#####################
# stan4bart package #
#####################
bla <- stan4bart(y ~ bart(x4 + x5 + x6 + x7 + z1 + z2) + x1 + x2 + x3 + (1 + x1 + x2 + x3|group),
data = simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]],
bart_args = list(verbose = FALSE,
k = 2.0,
n.samples = 1500L,
n.burn = 1500L,
n.thin = 5L))
# plotting y against predicted y from stan4bart
pred <- tibble(y = simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]$y,
ypred = fitted(bla, type = 'ev', sample = 'train'))
ggplot(data = pred, mapping = aes(
x = y,
y = ypred
)) +
geom_point(color = 'royalblue', size = .5) +
theme_minimal() +
geom_abline(slope = 1, intercept = 0, color = 'royalblue4')
