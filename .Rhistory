warnings()
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.pdf', dpi = 'retina', width = 8.8, height = 6.92, units = 'in')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.pdf', dpi = 'retina', width = 10, height = 10, units = 'in')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.pdf', dpi = 'retina', width = 20, height = 20, units = 'in')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.pdf', dpi = 'retina')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.pdf', dpi = 'retina')
warnings()
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png', dpi = 'retina')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png', dpi = 'retina', width = 8.8, height = 6.92, units = 'in')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina', width = 8.8, height = 6.92, units = 'in')
#####################
# stan4bart package #
#####################
bla <- stan4bart(y ~ bart(x4 + x5 + x6 + x7 + z1 + z2 + x1 + x2 + x3) + (1 + x1 + x2 + x3|group),
data = simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]],
bart_args = list(verbose = FALSE,
k = 2.0,
n.samples = 1500L,
n.burn = 1500L,
n.thin = 5L))
# plotting y against predicted y from stan4bart
pred <- tibble(y = simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]$y,
ypred = fitted(stan4bart_fit, type = 'ev', sample = 'train'))
simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]
simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]$y
# plotting y against predicted y from stan4bart
pred <- tibble(y = simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]$y,
ypred = fitted(bla, type = 'ev', sample = 'train'))
ggplot(data = pred, mapping = aes(
x = y,
y = ypred
)) +
geom_point(color = 'royalblue', size = .5) +
theme_minimal() +
geom_abline(slope = 1, intercept = 0, color = 'royalblue4')
View(bla)
bla[["stan"]]
bla[["bart_train"]]
bla[["bartData"]]@x
simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]
bla[["bart_varcount"]]
bla[["bart_train"]] %>% View()
.
#####################
# stan4bart package #
#####################
bla <- stan4bart(y ~ bart(x4 + x5 + x6 + x7 + z1 + z2) + x1 + x2 + x3 + (1 + x1 + x2 + x3|group),
data = simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]],
bart_args = list(verbose = FALSE,
k = 2.0,
n.samples = 1500L,
n.burn = 1500L,
n.thin = 5L))
# plotting y against predicted y from stan4bart
pred <- tibble(y = simdatasets$simdata_ngroup_30_groupsize_5_icc_0.5_mar_mcar_0_g_0.2[[1]]$y,
ypred = fitted(bla, type = 'ev', sample = 'train'))
ggplot(data = pred, mapping = aes(
x = y,
y = ypred
)) +
geom_point(color = 'royalblue', size = .5) +
theme_minimal() +
geom_abline(slope = 1, intercept = 0, color = 'royalblue4')
2595 - 2461
2595-134
2618 - 134
2621 -134
library(magrittr)
library(ggplot2)
library(tibble)
library(dplyr)
library(knitr)
library(gridExtra)
library(tidyr)
################
# Setting seed #
################
set.seed(123)
########
# Data #
########
load("~/Desktop/Universiteit Utrecht/Methodology & Statistics for the Behavioural, Biomedical and Social Sciences/Year 2/Master Thesis/data/simdatasets.RData")
##########
# Models #
##########
load('results/stan4bart_fits.RData')
load('results/rbart_evs.RData')
load('results/rbart_ranefs.RData')
load('results/bart_fits.RData')
load('results/gbart_fits.RData')
# coverage
#########
# Plots #
#########
# bias for all models and all combinations
bias_models <- tibble(stan4bart = stan4bart_bias$avgbias,
rbart = rbart_bias$avgbias,
bart = bart_bias$avgbias,
gbart = gbart_bias$avgbias,
dataset = paste0((combinations[,1]*combinations[,2]), ' (', combinations[,1], ', ', combinations[,2], ')', sep = '')) %>%
cbind(., combinations) %>%
select(-mar_mcar) %>%
pivot_longer(cols = c(stan4bart, rbart, bart, gbart), names_to = 'model', values_to = 'bias') %>%
group_by(dataset, model, icc, ngroup, groupsize, g) %>%
summarise(across(bias, ~ mean(.x)), .groups = "drop") %>%
arrange((ngroup*groupsize)) %>%
mutate(dataset = factor(dataset, levels = unique(dataset)))
colnames(bias_models)[6] <- paste('γ')
# saving for presentation
save(bias_models, file = 'oralpresentation/results/bias_models.RData')
# mse for all models and all combinations
mse_models <- tibble(stan4bart = stan4bart_mse$avgmse,
rbart = rbart_mse$avgmse,
bart = bart_mse$avgmse,
gbart = gbart_mse$avgmse,
dataset = paste0((combinations[,1]*combinations[,2]), ' (', combinations[,1], ', ', combinations[,2], ')', sep = '')) %>%
cbind(., combinations) %>%
select(-mar_mcar) %>%
pivot_longer(cols = c(stan4bart, rbart, bart, gbart), names_to = 'model', values_to = 'mse') %>%
group_by(dataset, model, icc, ngroup, groupsize, g) %>%
summarise(across(mse, ~ mean(.x)), .groups = "drop") %>%
arrange((ngroup*groupsize))  %>%
mutate(dataset = factor(dataset, levels = unique(dataset)))
colnames(mse_models)[6] <- paste('γ')
# saving for presentation
save(mse_models, file = 'oralpresentation/results/mse_models.RData')
# color palette
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png', dpi = 'retina', width = 8.8, height = 6.92, units = 'in')
ggplot(mse_models ,aes(
x = dataset,
y = mse,
fill = model,
color = model,
shape = model,
group = model
)) +
#geom_bar(stat = 'identity', position = 'identity', width = .05) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'MSE') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina', width = 8.8, height = 6.92, units = 'in')
2622-135
2623-135
2622-135
2616-135
2624-135
2647-135
2640-135
2635-135
2633-135
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina', width = 8.8, height = 9.92, units = 'in')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina', width = 8.8, height = 12.92, units = 'in')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png', dpi = 'retina', width = 8.8, height = 12.92, units = 'in')
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png', dpi = 'retina', width = 8.8, height = 12.92, units = 'in')
ggplot(mse_models ,aes(
x = dataset,
y = mse,
fill = model,
color = model,
shape = model,
group = model
)) +
#geom_bar(stat = 'identity', position = 'identity', width = .05) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'MSE') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina', width = 8.8, height = 12.92, units = 'in')
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png', dpi = 'retina', width = 8.8, height = 11.92, units = 'in')
ggplot(mse_models ,aes(
x = dataset,
y = mse,
fill = model,
color = model,
shape = model,
group = model
)) +
#geom_bar(stat = 'identity', position = 'identity', width = .05) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'MSE') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina', width = 8.8, height = 11.92, units = 'in')
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png', dpi = 'retina', width = 8.8, height = 9.92, units = 'in')
ggplot(mse_models ,aes(
x = dataset,
y = mse,
fill = model,
color = model,
shape = model,
group = model
)) +
#geom_bar(stat = 'identity', position = 'identity', width = .05) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'MSE') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina', width = 8.8, height = 9.92, units = 'in')
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png', dpi = 'retina', width = 8.8, height = 10.92, units = 'in')
ggplot(mse_models ,aes(
x = dataset,
y = mse,
fill = model,
color = model,
shape = model,
group = model
)) +
#geom_bar(stat = 'identity', position = 'identity', width = .05) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'MSE') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina', width = 8.8, height = 10.92, units = 'in')
2631 - 135
ggplot(mse_models ,aes(
x = dataset,
y = mse,
fill = model,
color = model,
shape = model,
group = model
)) +
#geom_bar(stat = 'identity', position = 'identity', width = .05) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'MSE') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom', legend.title = 'Model') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
?theme
ggplot(mse_models ,aes(
x = dataset,
y = mse,
fill = model,
color = model,
shape = model,
group = model
)) +
#geom_bar(stat = 'identity', position = 'identity', width = .05) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'MSE',
fill = 'Model') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
ggplot(mse_models ,aes(
x = dataset,
y = mse,
fill = model,
color = model,
shape = model,
group = model
)) +
#geom_bar(stat = 'identity', position = 'identity', width = .05) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'MSE',
color = 'Model') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
ggplot(mse_models ,aes(
x = dataset,
y = mse,
fill = model,
color = model,
shape = model,
group = model
)) +
#geom_bar(stat = 'identity', position = 'identity', width = .05) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'MSE') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
ggplot(mse_models ,aes(
x = dataset,
y = mse,
fill = model,
color = model,
shape = model,
group = model
)) +
#geom_bar(stat = 'identity', position = 'identity', width = .05) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'MSE',
fill = 'Model',
color = 'Model',
shape = 'Model',
group = 'Model') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/mseplot.png', dpi = 'retina', width = 8.8, height = 10.92, units = 'in')
ggplot(bias_models ,aes(
x = dataset,
y = bias,
fill = model,
color = model,
shape = model,
group = model
)) +
geom_point(stat = 'identity') +
geom_line(stat = 'identity', linetype = 'dashed', alpha = .3) +
geom_abline(intercept = 0, slope = 0, linetype = 'dashed') +
labs(
x = 'Simulated dataset (total sample size (number of groups, group size))',
y = 'Relative bias',
fill = 'Model',
color = 'Model',
shape = 'Model',
group = 'Model') +
theme_bw() +
theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1), legend.position = 'bottom') +
scale_fill_manual(values=cbbPalette) +
scale_color_manual(values=cbbPalette) +
facet_grid(rows = vars(icc), cols = vars(γ), labeller = 'label_both', scales = 'free_x')
#facet_wrap(~icc, labeller = 'label_both')
ggsave('researchreport/graphs/biasplot.png', dpi = 'retina', width = 8.8, height = 10.92, units = 'in')
